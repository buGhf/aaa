<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>System App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- –ë–ê–ó–ê –ò –¶–í–ï–¢–ê --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root {
            --bg-color: #000000;
            --card-bg: #151517; /* –ß—É—Ç—å —Ç–µ–º–Ω–µ–µ –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --accent-color: #0a84ff;
            --accent-gradient: linear-gradient(135deg, #0a84ff 0%, #007aff 100%);
            --life-gradient: linear-gradient(90deg, #30d158 0%, #ffd60a 50%, #ff453a 100%);
            --success-gradient: linear-gradient(135deg, #30d158 0%, #208e3b 100%);
            --separator: rgba(255, 255, 255, 0.08);
            --success: #30d158;
            --danger: #ff453a;
        }
        body {
            background-color: var(--bg-color); color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; /* –ù–æ–≤—ã–π —à—Ä–∏—Ñ—Ç */
            margin: 0; padding: 0; padding-bottom: 95px; padding-top: 50px;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased; /* –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ */
        }

        /* --- PRELOADER (–≠–ö–†–ê–ù –ó–ê–ì–†–£–ó–ö–ò) --- */
        #preloader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s;
        }
        .loader-icon { font-size: 60px; animation: pulse 1.5s infinite; }

        /* --- –ê–ù–ò–ú–ê–¶–ò–ò –ù–ê–ñ–ê–¢–ò–Ø (–ì–õ–ê–í–ù–ê–Ø –§–ò–®–ö–ê) --- */
        .card, .nav-item, .main-btn, .toggle-btn, .task-add-btn, .battle-reset, .vision-card, .menu-item {
            transition: transform 0.1s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.2s, background-color 0.2s;
            cursor: pointer;
        }
        .card:active, .main-btn:active, .vision-card:active { transform: scale(0.96); }
        .nav-item:active { transform: scale(0.9); }
        
        /* --- UI –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .header {
            position: fixed; top: 0; left: 0; width: 100%; height: 50px;
            background: rgba(21, 21, 23, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--separator); display: flex; align-items: center; justify-content: center;
            z-index: 900; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .header.visible { opacity: 1; pointer-events: auto; }
        .header h1 { font-size: 16px; font-weight: 600; margin: 0; letter-spacing: -0.02em; }

        .tab-content { display: none; padding: 20px 16px; animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .tab-content.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* --- ONBOARDING --- */
        .onboarding-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 5000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 30px; text-align: center;
            transition: opacity 0.5s ease;
        }
        .onboarding-overlay.hidden { opacity: 0; pointer-events: none; }
        .slide { display: none; animation: fadeIn 0.5s; flex-direction: column; align-items: center; height: 100%; justify-content: center; }
        .slide.active { display: flex; }
        .ob-icon { font-size: 80px; margin-bottom: 30px; filter: drop-shadow(0 0 40px rgba(10, 132, 255, 0.3)); }
        .ob-title { font-size: 32px; font-weight: 800; margin-bottom: 15px; line-height: 1.1; letter-spacing: -0.03em; }
        .ob-text { font-size: 16px; color: var(--text-secondary); line-height: 1.5; margin-bottom: 40px; max-width: 300px; }
        .ob-dots { display: flex; gap: 8px; margin-bottom: 30px; }
        .dot { width: 8px; height: 8px; background: rgba(255,255,255,0.2); border-radius: 50%; transition: all 0.3s; }
        .dot.active { background: var(--accent-color); width: 24px; border-radius: 4px; }

        /* --- –ì–õ–ê–í–ù–ê–Ø --- */
        .hero-section { padding: 15px 0 25px; text-align: center; }
        .user-avatar-large {
            width: 80px; height: 80px; border-radius: 50%; background: #333; margin: 0 auto 15px;
            object-fit: cover; border: 3px solid #000; outline: 2px solid var(--accent-color); 
            box-shadow: 0 10px 40px -10px rgba(10, 132, 255, 0.5);
        }
        .greeting { font-size: 28px; font-weight: 800; margin-bottom: 5px; letter-spacing: -0.03em; }
        .sub-greeting { color: var(--text-secondary); font-size: 15px; font-weight: 500; }

        /* --- –í–†–ï–ú–Ø --- */
        .time-card {
            background: var(--card-bg); border-radius: 20px; padding: 20px;
            margin: 20px 0; border: 1px solid var(--separator);
            position: relative; overflow: hidden; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .time-header-row { display: flex; justify-content: space-between; align-items: center; }
        .date-display { font-size: 18px; font-weight: 700; color: #fff; letter-spacing: -0.02em; }
        .toggle-btn {
            background: rgba(255,255,255,0.05); width: 36px; height: 36px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.3s;
        }
        .toggle-icon { font-size: 10px; color: var(--text-secondary); transition: transform 0.3s; }
        .time-body { margin-top: 24px; opacity: 1; max-height: 200px; overflow: hidden; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .time-card.collapsed .time-body { margin-top: 0; opacity: 0; max-height: 0; }
        .time-card.collapsed .toggle-icon { transform: rotate(180deg); }
        .time-row { margin-bottom: 18px; }
        .time-label { display: flex; justify-content: space-between; font-size: 13px; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px; }
        .time-track { width: 100%; height: 10px; background: rgba(255,255,255,0.05); border-radius: 6px; overflow: hidden; }
        .time-fill { height: 100%; border-radius: 6px; background: var(--life-gradient); transition: width 1s linear; }

        /* --- –ë–û–ï–í–û–ô –û–¢–ß–ï–¢ --- */
        .battle-card {
            background: var(--card-bg); border-radius: 20px; padding: 24px;
            margin: 20px 0; border: 1px solid var(--separator);
            transition: box-shadow 0.3s, border-color 0.3s;
        }
        .battle-card.all-done { border-color: rgba(48, 209, 88, 0.3); box-shadow: 0 0 30px rgba(48, 209, 88, 0.1); }
        .battle-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .battle-title { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .battle-reset { font-size: 13px; color: var(--accent-color); font-weight: 600; cursor: pointer; padding: 6px 12px; background: rgba(10, 132, 255, 0.1); border-radius: 8px; }
        .task-input-row { display: flex; gap: 10px; margin-bottom: 20px; }
        .task-input { flex: 1; background: #000; border: 1px solid var(--separator); color: #fff; padding: 12px 16px; border-radius: 12px; font-size: 16px; outline: none; font-family: 'Inter', sans-serif; }
        .task-input:focus { border-color: var(--accent-color); }
        .task-add-btn { width: 48px; background: var(--accent-color); color: #fff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; }
        .task-list { display: flex; flex-direction: column; gap: 12px; }
        .task-item { display: flex; align-items: center; justify-content: space-between; padding: 14px; background: rgba(255,255,255,0.03); border-radius: 12px; transition: opacity 0.2s; border: 1px solid transparent; }
        .task-item:active { background: rgba(255,255,255,0.06); }
        .task-item.completed { opacity: 0.5; }
        .task-item.completed .task-text { text-decoration: line-through; color: var(--text-secondary); }
        .task-left { display: flex; align-items: center; gap: 14px; flex: 1; }
        .custom-checkbox { width: 24px; height: 24px; border-radius: 8px; border: 2px solid #444; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .task-item.completed .custom-checkbox { background: var(--success); border-color: var(--success); }
        .custom-checkbox::after { content: '‚úì'; color: #000; font-size: 14px; font-weight: 800; display: none; }
        .task-item.completed .custom-checkbox::after { display: block; }
        .task-text { font-size: 16px; font-weight: 500; }
        .task-del { color: var(--text-secondary); padding: 8px; cursor: pointer; font-size: 20px; }
        .battle-progress { height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; margin-top: 20px; overflow: hidden; }
        .battle-fill { height: 100%; background: var(--success-gradient); width: 0%; transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1); }

        /* --- VISION BOARD --- */
        .vision-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .vision-card { aspect-ratio: 1 / 1; background: var(--card-bg); border-radius: 16px; position: relative; overflow: hidden; border: 1px solid var(--separator); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .vision-card.filled::before { content: ''; position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 60%); z-index: 1; }
        .vision-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; transition: transform 0.5s; }
        .vision-card:active .vision-img { transform: scale(1.05); }
        .vision-title { position: relative; z-index: 2; font-size: 13px; font-weight: 700; padding: 12px; color: #fff; width: 100%; margin-top: auto; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .vision-card.empty .vision-title { margin-top: 10px; color: var(--text-secondary); text-shadow: none; }
        .vision-icon { font-size: 32px; color: #333; transition: color 0.2s; }
        .vision-plus { font-size: 40px; color: var(--accent-color); }
        .vision-delete { position: absolute; top: 8px; right: 8px; z-index: 10; background: rgba(0,0,0,0.5); width: 28px; height: 28px; border-radius: 50%; color: #ff453a; display: flex; align-items: center; justify-content: center; font-size: 14px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }

        /* --- VICTORY OVERLAY --- */
        .victory-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 3000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.5s; backdrop-filter: blur(20px);
        }
        .victory-overlay.show { opacity: 1; pointer-events: auto; }
        .trophy-anim { font-size: 100px; margin-bottom: 20px; animation: bounce 1.5s infinite alternate; filter: drop-shadow(0 0 50px rgba(255, 215, 0, 0.5)); }
        @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.1); } }
        .victory-title { font-size: 32px; font-weight: 900; color: #fff; margin-bottom: 10px; text-transform: uppercase; letter-spacing: -0.02em; }
        .victory-sub { font-size: 18px; color: #ffd700; font-weight: 600; margin-bottom: 40px; }
        .share-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1);
            padding: 16px 32px; border-radius: 40px; color: #fff; font-weight: 600; cursor: pointer;
            display: flex; align-items: center; gap: 10px; font-size: 16px; transition: background 0.2s;
        }
        .share-btn:active { background: rgba(255,255,255,0.2); }

        /* --- –û–ë–©–ï–ï --- */
        .progress-card { background: var(--card-bg); border-radius: 20px; padding: 24px; margin: 20px 0; border: 1px solid var(--separator); }
        .progress-header { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 15px; font-weight: 600; }
        .progress-track { width: 100%; height: 10px; background: rgba(255,255,255,0.05); border-radius: 5px; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: var(--accent-gradient); border-radius: 5px; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

        .quote-card {
            background: linear-gradient(135deg, #1c1c1e 0%, #252528 100%);
            border-radius: 20px; padding: 24px; position: relative; overflow: hidden;
            border: 1px solid var(--separator); margin-bottom: 25px;
        }
        .quote-icon { font-size: 60px; color: rgba(255,255,255,0.05); position: absolute; top: -10px; left: 10px; font-family: serif; }
        .quote-text { font-size: 18px; font-weight: 500; font-style: italic; line-height: 1.5; position: relative; z-index: 2; margin-bottom: 16px; color: #e5e7eb; }
        .quote-author { font-size: 14px; color: var(--accent-color); font-weight: 700; text-align: right; display: block; position: relative; z-index: 2; text-transform: uppercase; letter-spacing: 0.05em; }

        .main-btn {
            display: block; width: 100%; padding: 18px; background: var(--accent-gradient); color: #fff;
            text-align: center; border-radius: 16px; font-size: 17px; font-weight: 700; text-decoration: none;
            box-shadow: 0 10px 30px -10px rgba(10, 132, 255, 0.5); border: 1px solid rgba(255,255,255,0.1);
        }

        .section-header { font-size: 24px; font-weight: 800; margin: 35px 0 20px; color: #fff; padding-left: 10px; border-left: 4px solid var(--accent-color); line-height: 1; letter-spacing: -0.03em; }
        .card { background: linear-gradient(180deg, #1c1c1e 0%, #151517 100%); border-radius: 18px; overflow: hidden; margin-bottom: 24px; position: relative; border: 1px solid var(--separator); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .card.done { border-color: rgba(48, 209, 88, 0.4); } 
        .card.done::after { content: '‚úì'; position: absolute; top: 12px; right: 12px; background: var(--success); color: #000; font-weight: 800; font-size: 12px; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 5; box-shadow: 0 4px 10px rgba(48, 209, 88, 0.4); }
        .card-body { padding: 20px; }
        .card-title { font-size: 20px; font-weight: 700; margin-bottom: 8px; line-height: 1.2; letter-spacing: -0.02em; }
        .card-desc { font-size: 15px; color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5; }
        .badge { display: inline-block; padding: 6px 10px; background: rgba(10, 132, 255, 0.1); color: var(--accent-color); border-radius: 8px; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.05em; }
        .video-facade { position: relative; padding-bottom: 56.25%; height: 0; background-color: #000; cursor: pointer; }
        .video-cover-img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.8; transition: opacity 0.3s; }
        .play-button { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 64px; height: 64px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .play-button::after { content: ''; width: 0; height: 0; border-left: 20px solid #fff; border-top: 12px solid transparent; border-bottom: 12px solid transparent; margin-left: 6px; }

        audio { width: 100%; height: 40px; margin-top: 5px; opacity: 0.8; }
        details { background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid var(--separator); }
        summary { padding: 16px; cursor: pointer; font-weight: 600; color: var(--accent-color); list-style: none; display: flex; justify-content: space-between; align-items: center; }
        summary::after { content: '+'; font-size: 20px; font-weight: 300; }
        details[open] summary::after { content: '-'; }
        .text-content { padding: 20px; font-size: 16px; line-height: 1.7; color: #d1d1d6; border-top: 1px solid var(--separator); white-space: pre-wrap; }
        .text-content b { color: #fff; font-weight: 700; }
        .text-content i { color: var(--text-secondary); font-style: italic; }
        .text-content ul { padding-left: 20px; margin: 15px 0; }
        .highlight { color: var(--accent-color); font-weight: 700; }

        .profile-header { display: flex; align-items: center; margin-bottom: 35px; }
        .profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: #222; margin-right: 20px; object-fit: cover; border: 2px solid var(--separator); }
        .profile-info h2 { margin: 0; font-size: 22px; font-weight: 800; letter-spacing: -0.02em; }
        .profile-info p { margin: 5px 0 0 0; color: var(--text-secondary); font-size: 15px; }
        .menu-list { background: var(--card-bg); border-radius: 20px; overflow: hidden; border: 1px solid var(--separator); }
        .menu-item { padding: 18px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--separator); cursor: pointer; font-size: 16px; text-decoration: none; color: #fff; font-weight: 500; }
        .menu-item:last-child { border-bottom: none; }
        .menu-item:active { background: rgba(255,255,255,0.05); }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(8px); }
        .modal.open { display: flex; animation: fadeIn 0.3s; }
        .modal-content { background: #1c1c1e; border-radius: 24px; padding: 30px; width: 100%; max-width: 400px; border: 1px solid var(--separator); position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .modal-close { position: absolute; top: 20px; right: 20px; font-size: 28px; color: var(--text-secondary); cursor: pointer; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 85px; background: rgba(21, 21, 23, 0.9); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border-top: 1px solid var(--separator); display: flex; justify-content: space-between; padding: 10px 10px; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; color: #6b7280; font-size: 10px; font-weight: 600; width: 20%; cursor: pointer; transition: color 0.2s; padding-top: 5px; }
        .nav-item svg { width: 26px; height: 26px; margin-bottom: 4px; fill: currentColor; transition: transform 0.2s; }
        .nav-item.active { color: #fff; } /* –ë–µ–ª—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–≤–µ—Ç, –∫–∞–∫ –≤ iOS */
        .nav-item.active svg { transform: translateY(-2px); }

        .ai-placeholder { text-align: center; padding: 80px 20px; }
        .ai-icon { font-size: 80px; margin-bottom: 30px; display: inline-block; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="preloader">
        <div class="loader-icon">üè¥</div>
    </div>

    <div id="onboarding" class="onboarding-overlay hidden">
        <div class="slide active" id="slide-1">
            <div class="ob-icon">üè¥</div>
            <div class="ob-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å<br>–≤ –°–∏—Å—Ç–µ–º—É</div>
            <div class="ob-text">–ó–¥–µ—Å—å –Ω–µ—Ç –º–µ—Å—Ç–∞ —Ç–µ–æ—Ä–∏–∏. –ú—ã –¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã —Ç—ã –≤–∑—è–ª –æ—Ç –∂–∏–∑–Ω–∏ —Å–≤–æ—ë.</div>
            <div class="ob-dots"><div class="dot active"></div><div class="dot"></div><div class="dot"></div></div>
            <a href="#" onclick="nextSlide(2)" class="main-btn" style="width: 80%;">–ü–æ–Ω—è–ª</a>
        </div>
        <div class="slide" id="slide-2">
            <div class="ob-icon">‚è≥</div>
            <div class="ob-title">–í—Ä–µ–º–µ–Ω–∏ –Ω–µ—Ç</div>
            <div class="ob-text">–¢–∞–π–º–µ—Ä –Ω–∞ –≥–ª–∞–≤–Ω–æ–π –ø–æ–∫–∞–∂–µ—Ç, —Å–∫–æ–ª—å–∫–æ –≥–æ–¥–∞ —É–∂–µ —Å–æ–∂–∂–µ–Ω–æ. –≠—Ç–æ –ø—Ä–∞–≤–¥–∞, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å.</div>
            <div class="ob-dots"><div class="dot"></div><div class="dot active"></div><div class="dot"></div></div>
            <a href="#" onclick="nextSlide(3)" class="main-btn" style="width: 80%;">–î–∞–ª–µ–µ</a>
        </div>
        <div class="slide" id="slide-3">
            <div class="ob-icon">üéØ</div>
            <div class="ob-title">–î–µ–π—Å—Ç–≤—É–π</div>
            <div class="ob-text">–ó–∞–ø–æ–ª–Ω–∏ —Ü–µ–ª–∏. –ó–∞–∫—Ä—ã–≤–∞–π –∑–∞–¥–∞—á–∏ –ø—Ä—è–º–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç —É–∂–µ –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è.</div>
            <div class="ob-dots"><div class="dot"></div><div class="dot"></div><div class="dot active"></div></div>
            <a href="#" onclick="finishOnboarding()" class="main-btn" style="width: 80%;">–í–û–ô–¢–ò</a>
        </div>
    </div>

    <div id="victory-modal" class="victory-overlay">
        <div class="trophy-anim">üèÜ</div>
        <div class="victory-title">–î–ï–ù–¨ –í–ó–Ø–¢</div>
        <div class="victory-sub">–¢—ã –º–∞—à–∏–Ω–∞.</div>
        <div class="share-btn" onclick="shareVictory()">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="#fff"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.66 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
            –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
        </div>
    </div>

    <div class="header" id="main-header"><h1 id="header-title">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h1></div>

    <div id="tab-home" class="tab-content active">
        <div class="hero-section">
            <img src="" id="home-avatar" class="user-avatar-large" onerror="this.src='https://cdn-icons-png.flaticon.com/512/847/847969.png'">
            <div class="greeting">–ü—Ä–∏–≤–µ—Ç, <span id="username">–ß–µ–º–ø–∏–æ–Ω</span>!</div>
            <div class="sub-greeting">–ù–∞—á–Ω–∏ –∑–∞–±–∏—Ä–∞—Ç—å —Å–≤–æ—ë —Å–µ–≥–æ–¥–Ω—è.</div>
        </div>
        <div class="time-card" id="time-widget">
            <div class="time-header-row">
                <div class="date-display" id="current-date">...</div>
                <div class="toggle-btn" onclick="toggleTimeWidget()"><span class="toggle-icon">‚ñº</span></div>
            </div>
            <div class="time-body">
                <div class="time-row">
                    <div class="time-label"><span>–ì–æ–¥ –ø—Ä–æ—à–µ–ª –Ω–∞:</span><span id="year-percent" style="font-weight:700;">0%</span></div>
                    <div class="time-track"><div class="time-fill" id="year-bar" style="width: 0%"></div></div>
                </div>
                <div class="time-row" style="margin-bottom:0;">
                    <div class="time-label"><span>–î–µ–Ω—å –ø—Ä–æ—à–µ–ª –Ω–∞:</span><span id="day-percent" style="font-weight:700;">0%</span></div>
                    <div class="time-track"><div class="time-fill" id="day-bar" style="width: 0%"></div></div>
                </div>
            </div>
        </div>
        <div class="battle-card" id="battle-card">
            <div class="battle-header">
                <div class="battle-title">üéØ –ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                <div class="battle-reset" onclick="resetTasks()">–ù–æ–≤—ã–π –¥–µ–Ω—å ‚Üª</div>
            </div>
            <div class="task-input-row">
                <input type="text" id="task-input" class="task-input" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª—å...">
                <div class="task-add-btn" onclick="addTask()">+</div>
            </div>
            <div class="task-list" id="task-list"></div>
            <div class="battle-progress"><div class="battle-fill" id="battle-bar"></div></div>
        </div>
        <div class="progress-card">
            <div class="progress-header">
                <span id="level-title">–£—Ä–æ–≤–µ–Ω—å: –ù–æ–≤–∏—á–æ–∫</span>
                <span id="progress-percent" style="color: var(--accent-color)">0%</span>
            </div>
            <div class="progress-track"><div class="progress-fill" id="progress-bar"></div></div>
        </div>
        <div class="quote-card">
            <div class="quote-icon">‚Äú</div>
            <div class="quote-text" id="quote-text">...</div>
            <span class="quote-author" id="quote-author"></span>
        </div>
    </div>

    <div id="tab-library" class="tab-content">
        <div class="section-header">–°–∏—Å—Ç–µ–º–∞</div>
        <div class="card" id="item-video1"><div class="video-facade" onclick="playContent('video1', this, 'Ja2VgG4I9KA')"><img src="cover1.jpg" class="video-cover-img"><div class="play-button"></div></div><div class="card-body"><span class="badge">–°—Ç–∞—Ä—Ç</span><div class="card-title">–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –Ω–∞—á–∞—Ç—å</div><div class="card-desc">–•–≤–∞—Ç–∏—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å. –ü—Ä–æ—Å—Ç–∞—è —Å—Ö–µ–º–∞ –∑–∞–ø—É—Å–∫–∞.</div></div></div>
        <div class="card" id="item-video2"><div class="video-facade" onclick="playContent('video2', this, 'NDYvxYSFbvA')"><img src="cover2.jpg" class="video-cover-img"><div class="play-button"></div></div><div class="card-body"><span class="badge">–ë–∞–∑–∞</span><div class="card-title">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –ø–æ-–Ω–æ–≤–æ–º—É</div></div></div>
        <div class="card" id="item-video3"><div class="video-facade" onclick="playContent('video3', this, 'sq9P1fyzLnk')"><img src="cover3.jpg" class="video-cover-img"><div class="play-button"></div></div><div class="card-body"><span class="badge">–ú–æ—Ç–∏–≤–∞—Ü–∏—è</span><div class="card-title">–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</div></div></div>
        <div class="card" id="item-video4"><div class="video-facade" onclick="playContent('video4', this, 'ayd3ULvow3k')"><img src="cover4.jpg" class="video-cover-img"><div class="play-button"></div></div><div class="card-body"><span class="badge">–û—à–∏–±–∫–∏</span><div class="card-title">–†–∞–±–æ—Ç–∞ –±–µ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</div></div></div>
        <div class="section-header">–ú—ã—à–ª–µ–Ω–∏–µ</div>
        <div class="card" id="item-video5"><div class="video-facade" onclick="playContent('video5', this, 'n9s_4jvxR0M')"><img src="cover5.jpg" class="video-cover-img"><div class="play-button"></div></div><div class="card-body"><span class="badge">–§–æ–∫—É—Å</span><div class="card-title">–¢–∏—à–∏–Ω–∞ –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è</div></div></div>
        <div class="card" id="item-video6"><div class="video-facade" onclick="playContent('video6', this, 'odtCZ2fsRRk')"><img src="cover6.jpg" class="video-cover-img"><div class="play-button"></div></div><div class="card-body"><span class="badge">–ü—Å–∏—Ö–æ–ª–æ–≥–∏—è</span><div class="card-title">–í—ã–≥–æ—Ä–∞–Ω–∏–µ: –≤—ã—Ö–æ–¥ –µ—Å—Ç—å</div></div></div>
        <div class="card" id="item-audio1"><div class="card-body"><span class="badge">–ê—É–¥–∏–æ</span><div class="card-title">üéô –û–∫—Ä—É–∂–µ–Ω–∏–µ</div><audio controls onplay="trackProgress('audio1')"><source src="https://dl.dropboxusercontent.com/scl/fi/m3z94htt3v3ttu3z7agsr/voice1.mp3?rlkey=her5gtxpmpjfprzdyndhaxnk3" type="audio/mpeg"></audio></div></div>
        <div class="card" id="item-audio2"><div class="card-body"><span class="badge">–ê—É–¥–∏–æ</span><div class="card-title">üéô –û—Ç–¥—ã—Ö</div><audio controls onplay="trackProgress('audio2')"><source src="https://dl.dropboxusercontent.com/scl/fi/1rgpu09you9nmkq1eke9s/voice2.mp3?rlkey=p8z9xs4wq3ba7jsk6fqszg4o6" type="audio/mpeg"></audio></div></div>
        <div class="section-header">–ì–∞–π–¥—ã</div>
        <div class="card" id="item-text1"><div class="card-body"><span class="badge">–°—Ç—Ä–∞—Ç–µ–≥–∏—è</span><div class="card-title">–ù–µ —Å–ª–∏–≤–∞–π —ç–Ω–µ—Ä–≥–∏—é</div><details ontoggle="if(this.open) trackProgress('text1')"><summary>–ß–∏—Ç–∞—Ç—å</summary><div class="text-content">–ü—Ä–µ–¥—Å—Ç–∞–≤—å —Å–∏—Ç—É–∞—Ü–∏—é:<br><br><ul><li>–¢—ã –ø—Ä–∏–µ—Ö–∞–ª –Ω–∞ –∑–∞–ø—Ä–∞–≤–∫—É, –æ–ø–ª–∞—Ç–∏–ª –µ–µ –∏ 90% —Ç–æ–ø–ª–∏–≤–∞ —Ç—ã —Å–ª–∏–≤–∞–µ—à—å –Ω–∞ –∞—Å—Ñ–∞–ª—å—Ç, –Ω–µ –≤ –±–∞–∫.</li></ul><i>–ß—É–≤—Å—Ç–≤—É–µ—à—å? –ù–µ –ø—Ä–∏—è—Ç–Ω–æ...</i><br><br><b>–¢–∞–∫ –≤–æ—Ç —Ç—ã –º–∞—à–∏–Ω–∞.</b> –í –Ω–∞—á–∞–ª–µ –¥–Ω—è —Ç—ã –ø–æ–ª–æ–Ω —ç–Ω–µ—Ä–≥–∏–∏, –Ω–æ —Ç—Ä–∞—Ç–∏—à—å –µ–µ –Ω–µ –Ω–∞ —Ç–µ –≤–µ—â–∏.<br><br><b>–°–¥–µ–ª–∞–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å—Ç–∏–º—É–ª–æ–º.</b></div></details></div></div>
        <div class="card" id="item-text2"><div class="card-body"><span class="badge">–°–≤—è–∑–∏</span><div class="card-title">–ö–∞–∫ –æ–±–∑–∞–≤–µ—Å—Ç–∏—Å—å —Å–≤—è–∑—è–º–∏</div><details ontoggle="if(this.open) trackProgress('text2')"><summary>–ß–∏—Ç–∞—Ç—å</summary><div class="text-content">–¢—É—Ç —Ç–æ–Ω–∫–∞—è –≥—Ä–∞–Ω—å...<br><br><b>–í–∑–∞–∏–º–æ–≤—ã–≥–æ–¥–∞.</b><br><br>–í–∞–∂–Ω–æ –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å "—á–µ–º —è –º–æ–≥—É –±—ã—Ç—å –ø–æ–ª–µ–∑–µ–Ω" ,–∞ —Å—Ä–∞–∑—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ.</div></details></div></div>
    </div>

    <div id="tab-vision" class="tab-content">
        <div class="hero-section"><div class="greeting">–¢–≤–æ—ë –í–∏–¥–µ–Ω–∏–µ</div><div class="sub-greeting">–ó–∞–≥—Ä—É–∂–∞–π —Å–≤–æ–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.</div></div>
        <div class="vision-grid" id="vision-grid"></div>
    </div>

    <div id="tab-ai" class="tab-content">
        <div class="ai-placeholder">
            <div class="ai-icon">üß†</div><h2 style="margin-top:0;">AI –ú–µ–Ω—Ç–æ—Ä</h2><p style="color:#8e8e93; font-size:15px; line-height:1.5;">–Ø –ø–æ–¥–∫–ª—é—á–∞—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç–∞–Ω–µ—Ç —Ç–≤–æ–∏–º –ª–∏—á–Ω—ã–º –∫–æ—É—á–µ–º.<br>–û–Ω–∞ –Ω–µ –±—É–¥–µ—Ç —Ç–µ–±—è –∂–∞–ª–µ—Ç—å. –û–Ω–∞ –±—É–¥–µ—Ç –¥–∞–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</p><div style="margin-top: 30px; padding: 15px; border: 1px dashed #444; border-radius: 12px; color: #666; font-size: 13px;">–°—Ç–∞—Ç—É—Å: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤...</div>
        </div>
    </div>

    <div id="tab-profile" class="tab-content">
        <div class="profile-header"><img src="" id="profile-avatar" class="profile-avatar" onerror="this.src='https://cdn-icons-png.flaticon.com/512/847/847969.png'"><div class="profile-info"><h2 id="profile-name">–ó–∞–≥—Ä—É–∑–∫–∞...</h2><p>–£—á–∞—Å—Ç–Ω–∏–∫ –∫–ª—É–±–∞</p></div></div>
        <div class="menu-list">
            <a href="https://t.me/Ivannote" class="menu-item" style="color: var(--accent-color)"><span>üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ / –í–æ–ø—Ä–æ—Å</span><span class="arrow">‚ûî</span></a>
            <div class="menu-item" onclick="openModal()"><span>‚ÑπÔ∏è –û —Å—É—Ç–∏ (–ú–∞–Ω–∏—Ñ–µ—Å—Ç)</span><span class="arrow">–ß–∏—Ç–∞—Ç—å</span></div>
            <div class="menu-item" onclick="resetProgress()"><span style="color: #ff453a">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ (–°–±—Ä–æ—Å)</span><span class="arrow">‚ü≥</span></div>
        </div>
        <div style="text-align: center; margin-top: 30px; color: #444; font-size: 12px;">–í–µ—Ä—Å–∏—è 16.0 (Premium)</div>
    </div>

    <input type="file" id="vision-file-input" accept="image/*" style="display: none;">
    <div class="modal" id="about-modal"><div class="modal-content"><div class="modal-close" onclick="closeModal()">√ó</div><h2 style="margin-top:0;">–û —Å—É—Ç–∏</h2><div style="line-height:1.6; color: #d1d1d6; font-size: 15px;">–¢—ã –∑–¥–µ—Å—å –Ω–µ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —É—á–∏—Ç—å—Å—è. <br><b>–¢—ã –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å.</b><br><br>–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî —Ç–≤–æ–π –ª–∏—á–Ω—ã–π —á–∏—Ç-–∫–æ–¥ –∫ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏. –ú—ã —É–±—Ä–∞–ª–∏ –≤—Å—ë –ª–∏—à–Ω–µ–µ, —á—Ç–æ–±—ã —Ç—ã —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º:<br><br>‚Ä¢ <b>–Ø—Å–Ω—ã–π —É–º</b> ‚Äî –∫–æ–≥–¥–∞ –¥—Ä—É–≥–∏–µ –ø–∞–Ω–∏–∫—É—é—Ç.<br>‚Ä¢ <b>–≠–Ω–µ—Ä–≥–∏—è</b> ‚Äî –∫–æ–≥–¥–∞ –¥—Ä—É–≥–∏–µ –≤—ã–≥–æ—Ä–∞—é—Ç.<br>‚Ä¢ <b>–í–ª–∏—è–Ω–∏–µ</b> ‚Äî –∫–æ–≥–¥–∞ –¥—Ä—É–≥–∏–µ –ø—Ä–æ—Å—è—Ç.<br><br><span class="highlight">–ü—Ä–æ—Å—Ç–æ –∑–∞–±–∏—Ä–∞–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.</span> –†–µ–∑—É–ª—å—Ç–∞—Ç —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω –≤ –°–∏—Å—Ç–µ–º—É.</div></div></div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('tab-home', '', this)"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>–ì–ª–∞–≤–Ω–∞—è</span></div>
        <div class="nav-item" id="nav-library" onclick="switchTab('tab-library', '–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π', this)"><svg viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"/></svg><span>–ë–∞–∑–∞</span></div>
        <div class="nav-item" onclick="switchTab('tab-vision', '–¶–µ–ª–∏', this)"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg><span>–¶–µ–ª–∏</span></div>
        <div class="nav-item" onclick="switchTab('tab-ai', 'AI –ú–µ–Ω—Ç–æ—Ä', this)"><svg viewBox="0 0 24 24"><path d="M12 2c1.1 0 2 .9 2 2h4v2h2v14H4V6h2V4h4c0-1.1.9-2 2-2zm0 2c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm6 4H6v12h12V8zm-6 2c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3z"/></svg><span>–ú–µ–Ω—Ç–æ—Ä</span></div>
        <div class="nav-item" onclick="switchTab('tab-profile', '–ü—Ä–æ—Ñ–∏–ª—å', this)"><svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand(); tg.setHeaderColor('#000000'); tg.setBackgroundColor('#000000');

        // PRELOADER
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('preloader').style.opacity = '0';
                setTimeout(() => document.getElementById('preloader').style.visibility = 'hidden', 500);
            }, 800);
        });

        // --- ONBOARDING LOGIC ---
        function checkOnboarding() {
            if (!localStorage.getItem('onboardingComplete')) {
                document.getElementById('onboarding').classList.remove('hidden');
            }
        }
        function nextSlide(n) {
            document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
            document.getElementById('slide-' + n).classList.add('active');
        }
        function finishOnboarding() {
            localStorage.setItem('onboardingComplete', 'true');
            document.getElementById('onboarding').classList.add('hidden');
            tg.HapticFeedback.notificationOccurred('success');
        }
        checkOnboarding();

        // --- –¶–ò–¢–ê–¢–´ (31 —à—Ç) ---
        const quotes = [
            { text: "–°–æ–≤—Å–µ–º –Ω–µ –≤–∞–∂–Ω–æ, –∫–∞–∫ —Ç—ã —É–¥–∞—Ä–∏—à—å, –∞ –∫–∞–∫ –¥–µ—Ä–∂–∏—à—å —É–¥–∞—Ä.", author: "–†–æ–∫–∫–∏ –ë–∞–ª—å–±–æ–∞" },
            { text: "–†–∞–±–æ—Ç–∞–π, –ø–æ–∫–∞ —Ç–µ–±–µ –Ω–µ –ø—Ä–∏–¥–µ—Ç—Å—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å—Å—è.", author: "–•–∞—Ä–≤–∏ –°–ø–µ–∫—Ç–µ—Ä" },
            { text: "–õ–∏—à—å —É—Ç—Ä–∞—Ç–∏–≤ –≤—Å–µ –¥–æ –∫–æ–Ω—Ü–∞, –º—ã –æ–±—Ä–µ—Ç–∞–µ–º —Å–≤–æ–±–æ–¥—É.", author: "–¢–∞–π–ª–µ—Ä –î—ë—Ä–¥–µ–Ω" },
            { text: "–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ —Å—Ç–æ–∏—Ç –º–µ–∂–¥—É —Ç–æ–±–æ–π –∏ —Ü–µ–ª—å—é ‚Äî —ç—Ç–æ –±—Ä–µ–¥, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–µ–±–µ –Ω–µ—Å–µ—à—å.", author: "–î–∂–æ—Ä–¥–∞–Ω –ë–µ–ª—Ñ–æ—Ä—Ç" },
            { text: "–ï—Å—Ç—å –¥–≤–∞ –≤–∏–¥–∞ –±–æ–ª–∏: –±–æ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —Å–∏–ª—å–Ω–µ–µ, –∏ –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞—è –±–æ–ª—å.", author: "–§—Ä—ç–Ω–∫ –ê–Ω–¥–µ—Ä–≤—É–¥" },
            { text: "–õ–µ–≤ –Ω–µ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è –º–Ω–µ–Ω–∏–µ–º –æ–≤–µ—Ü.", author: "–¢–∞–π–≤–∏–Ω –õ–∞–Ω–Ω–∏—Å—Ç–µ—Ä" },
            { text: "–ù–∏–∫–æ–º—É –Ω–µ –ø–æ–∑–≤–æ–ª—è–π –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ —Ç—ã —á–µ–≥–æ-—Ç–æ –Ω–µ –º–æ–∂–µ—à—å.", author: "–í –ø–æ–≥–æ–Ω–µ –∑–∞ —Å—á–∞—Å—Ç—å–µ–º" },
            { text: "–î–µ–ª–∞–π –∏–ª–∏ –Ω–µ –¥–µ–ª–∞–π. –ù–µ –Ω–∞–¥–æ –ø—ã—Ç–∞—Ç—å—Å—è.", author: "–ô–æ–¥–∞" },
            { text: "–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø–æ–±–µ–∂–∞—Ç—å, —á—Ç–æ–±—ã –Ω–∞—É—á–∏—Ç—å—Å—è —Ö–æ–¥–∏—Ç—å.", author: "–¢–æ–Ω–∏ –°—Ç–∞—Ä–∫" },
            { text: "–¢—ã –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å —Ç–æ, —á—Ç–æ —Ö–æ—á–µ—à—å, —Å–≤–æ–∏–º–∏ —Å–∏–ª–∞–º–∏.", author: "–¢–æ–º–∞—Å –®–µ–ª–±–∏" },
            { text: "–í–µ–ª–∏–∫–∏–º–∏ –Ω–µ —Ä–æ–∂–¥–∞—é—Ç—Å—è, –≤–µ–ª–∏–∫–∏–º–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è.", author: "–ö—Ä–µ—Å—Ç–Ω—ã–π –æ—Ç–µ—Ü" },
            { text: "–ï—Å–ª–∏ —É–º–µ–µ—à—å —á—Ç–æ-—Ç–æ –¥–µ–ª–∞—Ç—å, –Ω–µ –¥–µ–ª–∞–π —ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ.", author: "–î–∂–æ–∫–µ—Ä" },
            { text: "–°–∞–º—ã–π —Ü–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä, –∫–æ—Ç–æ—Ä—ã–π —è –∑–Ω–∞—é ‚Äî —ç—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è.", author: "–ì–æ—Ä–¥–æ–Ω –ì–µ–∫–∫–æ" },
            { text: "–ù–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å. –ù–∏—á—Ç–æ –≤ –º–∏—Ä–µ –Ω–µ –∑–∞–º–µ–Ω–∏—Ç –Ω–∞—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.", author: "–†—ç–π –ö—Ä–æ–∫" },
            { text: "–Ø –º–æ–≥—É –ª–∏—à—å –ø–æ–∫–∞–∑–∞—Ç—å –¥–≤–µ—Ä—å. –¢—ã —Å–∞–º –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏.", author: "–ú–æ—Ä—Ñ–µ—É—Å" },
            { text: "–Ø –Ω–µ –≥–∞–¥–∞—é. –≠—Ç–æ –¥—É—Ä–Ω–∞—è –ø—Ä–∏–≤—ã—á–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–∞–≥—É–±–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ª–æ–≥–∏–∫—É.", author: "–®–µ—Ä–ª–æ–∫ –•–æ–ª–º—Å" },
            { text: "–Ø –Ω–µ –≤ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –Ø –∏ –µ—Å—Ç—å –æ–ø–∞—Å–Ω–æ—Å—Ç—å.", author: "–£–æ–ª—Ç–µ—Ä –£–∞–π—Ç" },
            { text: "–ù–µ—Ç –≤ –Ω–∞—à–µ–º —è–∑—ã–∫–µ —Å–ª–æ–≤–∞ –≤—Ä–µ–¥–Ω–µ–µ –∏ –æ–ø–∞—Å–Ω–µ–µ, —á–µ–º ¬´–ú–æ–ª–æ–¥–µ—Ü¬ª.", author: "–û–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å" },
            { text: "–°—Ç—Ä–∞—Ö —É–±–∏–≤–∞–µ—Ç —Ä–∞–∑—É–º.", author: "–î—é–Ω–∞" },
            { text: "–¢–æ, —á—Ç–æ –º—ã –¥–µ–ª–∞–µ–º –≤ –∂–∏–∑–Ω–∏, –æ—Ç–∑—ã–≤–∞–µ—Ç—Å—è –≤ –≤–µ—á–Ω–æ—Å—Ç–∏.", author: "–ì–ª–∞–¥–∏–∞—Ç–æ—Ä" },
            { text: "–ü—Ä–æ—à–µ–¥—à–µ–µ ‚Äî –∑–∞–±—ã—Ç–æ. –ë—É–¥—É—â–µ–µ ‚Äî –∑–∞–∫—Ä—ã—Ç–æ. –ù–∞—Å—Ç–æ—è—â–µ–µ ‚Äî –¥–∞—Ä–æ–≤–∞–Ω–æ.", author: "–£–≥–≤—ç–π" },
            { text: "–ú–∏—Ä –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ç–µ–±–µ.", author: "–õ–∏—Ü–æ —Å–æ —à—Ä–∞–º–æ–º" },
            { text: "–Ø –±—ã–ª —Å–ª–µ–ø, –Ω–æ —Ç–µ–ø–µ—Ä—å —è –≤–∏–∂—É.", author: "–û–±–ª–∞—Å—Ç–∏ —Ç—å–º—ã" },
            { text: "–ù–µ—Ç –Ω–∏—á–µ–≥–æ –±–ª–∞–≥–æ—Ä–æ–¥–Ω–æ–≥–æ –≤ –±–µ–¥–Ω–æ—Å—Ç–∏.", author: "–í–æ–ª–∫ —Å –£–æ–ª–ª-—Å—Ç—Ä–∏—Ç" },
            { text: "–ó–∞—á–µ–º –º—ã –ø–∞–¥–∞–µ–º? –ß—Ç–æ–±—ã –Ω–∞—É—á–∏—Ç—å—Å—è –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è.", author: "–ë—ç—Ç–º–µ–Ω" },
            { text: "–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∑–≤–æ–ª—è–π –Ω–∏–∫–æ–º—É –∑–Ω–∞—Ç—å, –æ —á–µ–º —Ç—ã –¥—É–º–∞–µ—à—å.", author: "–ö—Ä–µ—Å—Ç–Ω—ã–π –æ—Ç–µ—Ü" },
            { text: "–ú–∏–ª–ª–∏–æ–Ω –¥–æ–ª–ª–∞—Ä–æ–≤ ‚Äî —ç—Ç–æ –Ω–µ –∫—Ä—É—Ç–æ. –ó–Ω–∞–µ—à—å, —á—Ç–æ –∫—Ä—É—Ç–æ? –ú–∏–ª–ª–∏–∞—Ä–¥.", author: "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å" },
            { text: "–¢—ã ‚Äî —ç—Ç–æ –Ω–µ —Ç–≤–æ—è —Ä–∞–±–æ—Ç–∞. –¢—ã ‚Äî —ç—Ç–æ –Ω–µ —Å–∫–æ–ª—å–∫–æ –¥–µ–Ω–µ–≥ —É —Ç–µ–±—è –≤ –±–∞–Ω–∫–µ.", author: "–ë–æ–π—Ü–æ–≤—Å–∫–∏–π –∫–ª—É–±" },
            { text: "–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏ –Ω–µ –æ–ø—Ä–∞–≤–¥—ã–≤–∞—é—Ç—Å—è.", author: "–•–∞—Ä–≤–∏ –°–ø–µ–∫—Ç–µ—Ä" },
            { text: "–¢–æ, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –Ω–µ —á–∏–Ω–∏.", author: "–¢–æ–Ω–∏ –°—Ç–∞—Ä–∫" },
            { text: "–ö–ª—é—á –∫ —É—Å–ø–µ—Ö—É? –ü—ã–ª—å –≤ –≥–ª–∞–∑–∞? –ù–µ—Ç. –≠—Ç–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞.", author: "–ò–Ω—Ç–µ—Ä—Å—Ç–µ–ª–ª–∞—Ä" }
        ];
        const todayQuote = quotes[new Date().getDate() % quotes.length];
        document.getElementById('quote-text').innerText = todayQuote.text;
        document.getElementById('quote-author').innerText = "‚Äî " + todayQuote.author;

        // --- –í–†–ï–ú–Ø ---
        function updateDateAndWidget() {
            const now = new Date();
            const options = { day: 'numeric', month: 'long', weekday: 'long' };
            const dateStr = now.toLocaleDateString('ru-RU', options);
            document.getElementById('current-date').innerText = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);
            const startOfYear = new Date(now.getFullYear(), 0, 1);
            const endOfYear = new Date(now.getFullYear() + 1, 0, 1);
            const yearPercent = ((now - startOfYear) / (endOfYear - startOfYear)) * 100;
            const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
            const dayPercent = ((now - startOfDay) / (endOfDay - startOfDay)) * 100;
            document.getElementById('year-bar').style.width = yearPercent + '%';
            document.getElementById('year-percent').innerText = yearPercent.toFixed(1) + '%';
            document.getElementById('day-bar').style.width = dayPercent + '%';
            document.getElementById('day-percent').innerText = dayPercent.toFixed(1) + '%';
        }
        setInterval(updateDateAndWidget, 1000); updateDateAndWidget();
        function toggleTimeWidget() {
            const widget = document.getElementById('time-widget');
            const isCollapsed = widget.classList.toggle('collapsed');
            localStorage.setItem('timeWidgetHidden', isCollapsed);
            tg.HapticFeedback.selectionChanged();
        }
        if(localStorage.getItem('timeWidgetHidden') === 'true') document.getElementById('time-widget').classList.add('collapsed');

        // --- –ë–û–ï–í–û–ô –û–¢–ß–ï–¢ ---
        let tasks = JSON.parse(localStorage.getItem('battleTasks')) || [];
        function renderTasks() {
            const list = document.getElementById('task-list'); list.innerHTML = ''; let completedCount = 0;
            tasks.forEach((task, index) => {
                if (task.done) completedCount++;
                const div = document.createElement('div');
                div.className = `task-item ${task.done ? 'completed' : ''}`;
                div.innerHTML = `<div class="task-left" onclick="toggleTask(${index})"><div class="custom-checkbox"></div><div class="task-text">${task.text}</div></div><div class="task-del" onclick="deleteTask(${index})">√ó</div>`;
                list.appendChild(div);
            });
            const percent = tasks.length === 0 ? 0 : (completedCount / tasks.length) * 100;
            document.getElementById('battle-bar').style.width = percent + '%';
            const card = document.getElementById('battle-card');
            if (tasks.length > 0 && percent === 100) card.classList.add('all-done'); else card.classList.remove('all-done');
        }
        function addTask() {
            const input = document.getElementById('task-input'); const text = input.value.trim();
            if (text) { tasks.push({ text: text, done: false }); saveTasks(); input.value = ''; tg.HapticFeedback.impactOccurred('light'); }
        }
        function toggleTask(index) {
            const was100 = (tasks.length > 0 && tasks.filter(t => t.done).length === tasks.length);
            tasks[index].done = !tasks[index].done; saveTasks(); tg.HapticFeedback.selectionChanged();
            if (!was100 && (tasks.length > 0 && tasks.filter(t => t.done).length === tasks.length)) showVictory();
        }
        function showVictory() { const overlay = document.getElementById('victory-modal'); overlay.classList.add('show'); tg.HapticFeedback.notificationOccurred('success'); setTimeout(() => { overlay.classList.remove('show'); }, 3000); }
        function shareVictory() {
            const text = "–Ø –∑–∞–∫—Ä—ã–ª –¥–µ–Ω—å –≤ –°–∏—Å—Ç–µ–º–µ. –ê —Ç—ã? @Ivannote"; 
            const url = "https://t.me/share/url?url=" + encodeURIComponent("https://t.me/Ivannote") + "&text=" + encodeURIComponent(text);
            tg.openTelegramLink(url);
        }
        function deleteTask(index) { tasks.splice(index, 1); saveTasks(); tg.HapticFeedback.impactOccurred('light'); }
        function resetTasks() { if(confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–µ–Ω—å?')) { tasks = tasks.filter(t => !t.done); saveTasks(); tg.HapticFeedback.notificationOccurred('success'); } }
        function saveTasks() { localStorage.setItem('battleTasks', JSON.stringify(tasks)); renderTasks(); }
        renderTasks();

        // --- VISION BOARD ---
        const defaultGoals = [ { id: 'car', title: '–ú–∞—à–∏–Ω–∞ –º–µ—á—Ç—ã', img: null }, { id: 'house', title: '–ú–æ–π –î–æ–º', img: null }, { id: 'style', title: '–ú–æ–π –°—Ç–∏–ª—å', img: null }, { id: 'watch', title: '–ß–∞—Å—ã / –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã', img: null }, { id: 'country', title: '–°—Ç—Ä–∞–Ω–∞ –¥–ª—è –∂–∏–∑–Ω–∏', img: null } ];
        let goals = JSON.parse(localStorage.getItem('userGoals')) || defaultGoals;
        let activeGoalIndex = -1;
        function renderGoals() {
            const grid = document.getElementById('vision-grid'); grid.innerHTML = '';
            goals.forEach((goal, index) => {
                const div = document.createElement('div'); div.className = `vision-card ${goal.img ? 'filled' : 'empty'}`;
                div.innerHTML = goal.img ? `<img src="${goal.img}" class="vision-img"><div class="vision-title">${goal.title}</div><div class="vision-delete" onclick="event.stopPropagation(); deleteGoalImage(${index})">√ó</div>` : `<div class="vision-icon">üì∑</div><div class="vision-title">${goal.title}</div>`;
                div.onclick = () => triggerUpload(index); grid.appendChild(div);
            });
            const addDiv = document.createElement('div'); addDiv.className = 'vision-card empty'; addDiv.innerHTML = `<div class="vision-plus">+</div><div class="vision-title">–°–≤–æ—è —Ü–µ–ª—å</div>`; addDiv.onclick = addNewGoal; grid.appendChild(addDiv);
        }
        function triggerUpload(index) { activeGoalIndex = index; document.getElementById('vision-file-input').click(); }
        function addNewGoal() { const title = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –Ø—Ö—Ç–∞):"); if(title) { goals.push({ id: 'custom-' + Date.now(), title: title, img: null }); saveGoals(); } }
        function deleteGoalImage(index) { if(confirm("–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ —ç—Ç–æ–π —Ü–µ–ª–∏?")) { goals[index].img = null; saveGoals(); } }
        function saveGoals() { try { localStorage.setItem('userGoals', JSON.stringify(goals)); renderGoals(); } catch (e) { alert("–ü–∞–º—è—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞!"); } }
        document.getElementById('vision-file-input').addEventListener('change', function(e) {
            const file = e.target.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
                    const MAX_WIDTH = 600; const scaleSize = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH; canvas.height = img.height * scaleSize;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    goals[activeGoalIndex].img = canvas.toDataURL('image/jpeg', 0.7);
                    saveGoals(); tg.HapticFeedback.notificationOccurred('success');
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        });
        renderGoals();

        // --- –û–ë–©–ï–ï ---
        const user = tg.initDataUnsafe.user;
        if (user) {
            const fullName = user.first_name + (user.last_name ? " " + user.last_name : "");
            document.getElementById('username').innerText = user.first_name;
            document.getElementById('profile-name').innerText = fullName;
            if (user.photo_url) { document.getElementById('home-avatar').src = user.photo_url; document.getElementById('profile-avatar').src = user.photo_url; }
        }
        const totalItems = 10;
        let completedItems = JSON.parse(localStorage.getItem('completedItems')) || [];
        function updateProgressUI() {
            const percent = Math.round((completedItems.length / totalItems) * 100);
            document.getElementById('progress-percent').innerText = percent + '%';
            document.getElementById('progress-bar').style.width = percent + '%';
            let status = "–ù–æ–≤–∏—á–æ–∫"; if(percent > 30) status = "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π"; if(percent > 70) status = "–ú–∞—à–∏–Ω–∞"; if(percent === 100) status = "–õ–µ–≥–µ–Ω–¥–∞";
            document.getElementById('level-title').innerText = "–£—Ä–æ–≤–µ–Ω—å: " + status;
            completedItems.forEach(id => { const el = document.getElementById('item-' + id); if(el) el.classList.add('done'); });
        }
        function trackProgress(id) { if (!completedItems.includes(id)) { completedItems.push(id); localStorage.setItem('completedItems', JSON.stringify(completedItems)); updateProgressUI(); tg.HapticFeedback.notificationOccurred('success'); } }
        function resetProgress() {
            if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å, —Ü–µ–ª–∏ –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ?')) {
                completedItems = [];
                localStorage.removeItem('completedItems');
                localStorage.removeItem('battleTasks');
                localStorage.removeItem('userGoals');
                localStorage.removeItem('onboardingComplete'); 
                localStorage.removeItem('timeWidgetHidden');
                location.reload(); 
            }
        }
        updateProgressUI();

        function playContent(id, element, videoId) {
            trackProgress(id);
            var iframe = document.createElement('iframe');
            iframe.src = 'https://www.youtube.com/embed/' + videoId + '?autoplay=1&modestbranding=1&rel=0&showinfo=0&controls=1';
            iframe.setAttribute('allowfullscreen', '');
            iframe.setAttribute('allow', 'autoplay; encrypted-media');
            element.innerHTML = ''; element.appendChild(iframe);
        }

        function switchTab(tabId, title, element) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active'); if(element) element.classList.add('active');
            const header = document.getElementById('main-header');
            if (tabId === 'tab-home') header.classList.remove('visible'); else { header.classList.add('visible'); document.getElementById('header-title').innerText = title; }
            tg.HapticFeedback.impactOccurred('light'); window.scrollTo({top: 0, behavior: 'smooth'});
        }
        function openModal() { document.getElementById('about-modal').classList.add('open'); }
        function closeModal() { document.getElementById('about-modal').classList.remove('open'); }
    </script>
</body>
</html>
